<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE: Working with NumPy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OGRE
   &#160;<span id="projectnumber">13.6</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('working-with-numpy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Working with NumPy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_tutorials_numpy"></a> <a class="el" href="namespace_ogre.html">Ogre</a> includes a Python component which automatically generates Python bindings from the C++ headers. However, with Python, you most likely do not only want to just use <a class="el" href="namespace_ogre.html">Ogre</a>, but connect it to other components. For this, the Component uses standard python protocols, that offer exposing the API in a pythonic way. In this tutorial, we will look how Ogre integrates with numpy.</p>
<dl class="section note"><dt>Note</dt><dd>this tutorial can be <a href="https://colab.research.google.com/github/OGRECave/ogre/blob/master/Samples/Python/numpy_sample.ipynb">run live in Google Colab here</a>.</dd></dl>
<p>We start with a simple 3 channel python array representing a green gradient:</p>
<div class="fragment"><div class="line">    arr = np.zeros((256, 256, 3), dtype=np.uint8)</div>
<div class="line">    arr[:,:,1] = np.mgrid[0:256,0:256][1]</div>
</div><!-- fragment --><p> <img src="numpy_arr.png" alt="" class="inline"/></p>
<p>To be able to load it into Ogre we now have to convert it to <code><a class="el" href="class_ogre_1_1_image.html" title="Class representing an image file.">Ogre.Image</a></code>. The underlying C++ API takes a raw <code>uchar*</code>. However, the python bindings accept any object implementing the Buffer Protocol. This means we can pass the numpy array as is.</p>
<div class="fragment"><div class="line">    ogre_img = <a class="code" href="class_ogre_1_1_image.html">Ogre.Image</a>()</div>
<div class="line">    ogre_img.loadDynamicImage(arr, 256, 256, Ogre.PF_BYTE_RGB)</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="class_ogre_1_1_texture_manager.html#ac6fb858ee86f3b7b75de32e3e04ee5c8">Ogre.TextureManager.getSingleton</a>().loadImage(<span class="stringliteral">&quot;gradient&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>, ogre_img)</div>
<div class="ttc" id="aclass_ogre_1_1_image_html"><div class="ttname"><a href="class_ogre_1_1_image.html">Ogre::Image</a></div><div class="ttdoc">Class representing an image file.</div><div class="ttdef"><b>Definition:</b> OgreImage.h:61</div></div>
<div class="ttc" id="aclass_ogre_1_1_texture_manager_html_ac6fb858ee86f3b7b75de32e3e04ee5c8"><div class="ttname"><a href="class_ogre_1_1_texture_manager.html#ac6fb858ee86f3b7b75de32e3e04ee5c8">Ogre::TextureManager::getSingleton</a></div><div class="ttdeci">static TextureManager &amp; getSingleton(void)</div><div class="ttdoc">Get the singleton instance.</div></div>
</div><!-- fragment --><p> Note that <code><a class="el" href="class_ogre_1_1_image.html" title="Class representing an image file.">Ogre.Image</a></code> is merely a view on the underlying array and no data is copied. While this is efficient, it also means that you have to ensure that the array does not get out of scope manually. Otherwise the application will crash due to accessing an invalid pointer.</p>
<p>For completeness we also create a small scene where we map the texture on a screen-centred rectangle. </p><div class="fragment"><div class="line">    mat = <a class="code" href="class_ogre_1_1_material_manager.html#a100f413d9d2316028e7ae740e5a43161">Ogre.MaterialManager.getSingleton</a>().create(<span class="stringliteral">&quot;gradient_mat&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>)</div>
<div class="line">    rpass = mat.getTechniques()[0].getPasses()[0]</div>
<div class="line">    rpass.setLightingEnabled(<span class="keyword">False</span>)</div>
<div class="line">    rpass.createTextureUnitState(<span class="stringliteral">&quot;gradient&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    rect = scn_mgr.createScreenSpaceRect(<span class="keyword">True</span>)</div>
<div class="line">    rect.setCorners(-0.5, 0.5, 0.5, -0.5) <span class="comment"># in normalized screen space</span></div>
<div class="line">    rect.setMaterial(mat)</div>
<div class="line"> </div>
<div class="line">    scn_mgr.getRootSceneNode().createChildSceneNode().attachObject(rect)</div>
<div class="ttc" id="aclass_ogre_1_1_material_manager_html_a100f413d9d2316028e7ae740e5a43161"><div class="ttname"><a href="class_ogre_1_1_material_manager.html#a100f413d9d2316028e7ae740e5a43161">Ogre::MaterialManager::getSingleton</a></div><div class="ttdeci">static MaterialManager &amp; getSingleton(void)</div><div class="ttdoc">Get the singleton instance.</div></div>
</div><!-- fragment --><p> As the rectangle does not cover the full scene, we also set a background colour </p><div class="fragment"><div class="line">    gray = np.array([0.3, 0.3, 0.3])</div>
<div class="line">    vp.setBackgroundColour(gray)</div>
</div><!-- fragment --><p>Here, the standard python sequence protocol is used. Therefore, the data is copied.</p>
<p>Finally, we want read-back rendered image into an array. To avoid superficial copies of the data, we again allocate the memory with numpy:</p>
<div class="fragment"><div class="line">    mem = np.empty((win.getHeight(), win.getWidth(), 3), dtype=np.uint8)</div>
<div class="line">    pb = <a class="code" href="class_ogre_1_1_pixel_box.html">Ogre.PixelBox</a>(win.getWidth(), win.getHeight(), 1, Ogre.PF_BYTE_RGB, mem)</div>
<div class="line">    win.copyContentsToMemory(pb, pb)</div>
<div class="ttc" id="aclass_ogre_1_1_pixel_box_html"><div class="ttname"><a href="class_ogre_1_1_pixel_box.html">Ogre::PixelBox</a></div><div class="ttdoc">A primitive describing a volume (3D), image (2D) or line (1D) of pixels in memory.</div><div class="ttdef"><b>Definition:</b> OgrePixelFormat.h:349</div></div>
</div><!-- fragment --><p> Note, that the convention of specifying width and height is swapped between Ogre and numpy.</p>
<p>Now we can store the image to disk using pyplot.</p>
<div class="fragment"><div class="line">    pyplot.imsave(<span class="stringliteral">&quot;screenshot.png&quot;</span>, mem)</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>There is also <a class="el" href="class_ogre_1_1_render_target.html#afb7ac36166a3e7c38a102edc6e7d2c1d" title="Writes the current contents of the render target to the named file.">Ogre::RenderTarget::writeContentsToFile</a> if you do not need the pixel data in Python.</dd></dl>
<p><img src="numpy_final.png" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
