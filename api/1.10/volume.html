<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE: Volume Component</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo-wetfloor.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OGRE
   &#160;<span id="projectnumber">1.10.12</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('volume.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Volume Component </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#howto">How to use it</a></li>
<li class="level1"><a href="#creation">Manual creation of a CSG-Tree</a></li>
<li class="level1"><a href="#triangles">Getting the triangles of the chunks</a></li>
<li class="level1"><a href="#intersecting">Intersecting a ray with a volume</a></li>
<li class="level1"><a href="#editing">Editing a Volume made from a GridSource</a></li>
</ul>
</div>
<div class="textblock"><p>Welcome to the Volume Component of OGRE. It is a component to render volumes. It can handle any volume data but featurewise has a tedency towards terrains. The terrain aspect means, that it's all about huge meshes being displayed with high performance via a level of detail mechanism. Thanks to volume rendering, caves, cliffes, holes and similar geometry can be displayed. Also constructive solid geometry gets easy.</p>
<p>A dense list of the features:</p><ul>
<li>Volume Rendering via Dual Marching Cubes</li>
<li>LOD mechanism via a chunk tree and marching squares skirts for crack patching</li>
<li>Data-Sources: 3D Textures with density values and the ability to buildup a CSG-Tree with 3D Textures, Spheres, Cubes, Planes, Intersection, Union, Difference and Negation, SimplexNoise addition</li>
<li>Loading a 3D Texture Scene from config files</li>
<li>An own file format for discrete density values which compresses a lot better</li>
<li>Realtime editing</li>
<li>Serialization and Deserialization from and to an own file format for discrete density values which compresses a lot better than 3D textures</li>
<li>A triplanar texturing example material</li>
<li>A triplanar texturing SubRenderState for the RTSS</li>
</ul>
<p>This documentation is only intended for the usage of the Volume Component, not the algorithms which make it work. If you want to get to know the theory behind it, you can read the articles on this page: <a href="http://volume-gfx.com/">http://volume-gfx.com/</a></p>
<h1><a class="anchor" id="howto"></a>
How to use it</h1>
<p>Here is an example loading the volume scene from a configuration file. The configuration file must be findable by the resource system of course. Only "OgreVolumeChunk.h" has to be included. </p><div class="fragment"><div class="line"><a class="code" href="class_ogre_1_1_volume_1_1_chunk.html">Ogre::Volume::Chunk</a> *volumeRoot = <a class="code" href="group___memory.html#gab5fc1358fd5a889de0a06d07e45df1ff">OGRE_NEW</a> <a class="code" href="class_ogre_1_1_volume_1_1_chunk.html">Ogre::Volume::Chunk</a>();</div><div class="line">SceneNode *volumeRootNode = mSceneMgr-&gt;getRootSceneNode()-&gt;createChildSceneNode(<span class="stringliteral">&quot;VolumeParent&quot;</span>);</div><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#a9557d5a30cbf29a46d4f8246a1e6d176">load</a>(volumeRootNode, mSceneMgr, <span class="stringliteral">&quot;volumeTerrain.cfg&quot;</span>);</div></div><!-- fragment --><p> The first line creates the volume chunk which is the MovableObject holding the Volume-Root. Next, a SceneNode is created where the volume(-tree) is attached to. And lastly, the volume is loaded from the configuration file "volumeTerrain.cfg". mSceneMgr is the SceneManager who should show the volume. Later, when you don't need it anymore, you have to free the volumeRoot Chunk via OGRE_DELETE.</p>
<h1><a class="anchor" id="creation"></a>
Manual creation of a CSG-Tree</h1>
<p>This example skips the configuration file and loads a simple CSG-Scene: An union of a 3D Texture and a sphere with 5 LOD levels. It also setups a material LOD system. First, create a sphere with the radius 5 at the coordinates 128, 150, 128: </p><div class="fragment"><div class="line"><a class="code" href="class_ogre_1_1_volume_1_1_c_s_g_sphere_source.html">Ogre::Volume::CSGSphereSource</a> sphere (5, Vector3(128, 150, 128));</div></div><!-- fragment --><p> Now a 3D texture from "volumeTerrainBig.dds" which has the world dimensions 256, 256, 256. The next flag indicates that the trilinear interpolation of the value-selection should be activated. We switch off the trilinear interpolation and the sobel filter of the normal for the sake of faster loading times: </p><div class="fragment"><div class="line"><a class="code" href="class_ogre_1_1_volume_1_1_texture_source.html">Ogre::Volume::TextureSource</a> volumeTexture (<span class="stringliteral">&quot;volumeTerrainBig.dds&quot;</span>, 256, 256, 256, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</div></div><!-- fragment --><p> Now combine them: </p><div class="fragment"><div class="line"><a class="code" href="class_ogre_1_1_volume_1_1_c_s_g_union_source.html">Ogre::Volume::CSGUnionSource</a> unionSrc (&amp;sphere, &amp;volumeTexture);</div></div><!-- fragment --><p> Set the general parameters, see the comments for their meaning: </p><div class="fragment"><div class="line"><a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html">Ogre::Volume::ChunkParameters</a> parameters;</div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a3e154a179b8c824f79b1b426608743ad">sceneManager</a> = mSceneMgr;       <span class="comment">// The SceneManager to use</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a111c9e9333e7ae3497fc818190a03fd8">src</a> = &amp;unionSrc;                <span class="comment">// The just created density source.</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a4444eac27c71e02886615dcf7fbfed27">baseError</a> = (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)1.8;          <span class="comment">// The error of the highest LOD-level</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#aa6186649b7323f937b83828eb86711fa">errorMultiplicator</a> = (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)0.9; <span class="comment">// The factor between each LOD-level (error = baseError * errorMultiplicator  * level)</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a986b4a97b153d50f65603ab507bb4614">skirtFactor</a> = (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)0.7;        <span class="comment">// Controls how long the skirts are. The lower the number, the shorter the skirts are. This saves geometry. But if they are too short, cracks might occure.</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#af6ed62b76c67d04eb98424414fb1dc72">scale</a> = 10;                     <span class="comment">// The displayed volume will be scaled by this factor.</span></div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#ae125003c00de0d6c0a1a4bd6b99c4ebf">maxScreenSpaceError</a> = 30;       <span class="comment">// The screen space error controlling when the LOD-levels change.</span></div></div><!-- fragment --><p>Create the root-chunk and load now. The two vectors define the area to be scanned in the volume-source. The following integer determines the amount of LOD-levels. </p><div class="fragment"><div class="line"><a class="code" href="class_ogre_1_1_volume_1_1_chunk.html">Ogre::Volume::Chunk</a> *volumeRoot = <a class="code" href="group___memory.html#gab5fc1358fd5a889de0a06d07e45df1ff">OGRE_NEW</a> Chunk();</div><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#a9557d5a30cbf29a46d4f8246a1e6d176">load</a>(mVolumeRootNode, Vector3::ZERO, Vector3(256), 5, &amp;parameters);</div></div><!-- fragment --><p> Now setup the global volume material: </p><div class="fragment"><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#a5129bccc53d17060635ada67443324f7">setMaterial</a>(<span class="stringliteral">&quot;triplanarReference&quot;</span>);</div></div><!-- fragment --> <h1><a class="anchor" id="triangles"></a>
Getting the triangles of the chunks</h1>
<p>When you want to integrate the volume triangles in a physics engine for example, you need to hand over the exact triangles. For this scenario, the ChunkParameters hold a pointer to a ''MeshBuilderCallback'' and a number ''lodCallbackLod''. The first is an interface with a single function ''trianglesReady'' which is called, when the triangles of a chunk are ready. The chunks are chosen via the ''lodCallbackLod''. If you build a volume with 3 LOD levels and you want the triangles of the highest detail level, you set this parameter to 3. Example:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyMeshBuilderCallback : <span class="keyword">public</span> MeshBuilderCallback</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span>  ready(<span class="keyword">const</span> SimpleRenderable *simpleRenderable, <span class="keyword">const</span> <a class="code" href="group___volume.html#gabf42f450c9ea75c61753f6d485cb8357">VecVertex</a> &amp;vertices, <span class="keyword">const</span> <a class="code" href="group___volume.html#ga325b1df965bf0137edd13bb52bc422be">VecIndices</a> &amp;indices, <span class="keywordtype">size_t</span> level, <span class="keywordtype">int</span> inProcess)</div><div class="line">    {</div><div class="line">        <span class="keywordtype">size_t</span> count = indices.size();</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; i += 3)</div><div class="line">        {</div><div class="line">            <a class="code" href="group___volume.html#ga90facc4b1e8fd828ae06b8edd0f5b701">Vertex</a> v1 = vertices[indices[i]];</div><div class="line">            <a class="code" href="group___volume.html#ga90facc4b1e8fd828ae06b8edd0f5b701">Vertex</a> v2 = vertices[indices[i + 1]];</div><div class="line">            <a class="code" href="group___volume.html#ga90facc4b1e8fd828ae06b8edd0f5b701">Vertex</a> v3 = vertices[indices[i + 2]];</div><div class="line">            <span class="comment">// Do something with the Triangle...</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>And using it like this: </p><div class="fragment"><div class="line"><a class="code" href="group___volume.html#ga89fbc5eed010b8802358563eb88e674a">ChunkParameters</a> parameters;</div><div class="line">...</div><div class="line">MyMeshBuilderCallback callback;</div><div class="line">parameters.<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a6403e2875cc7b81aefd43ba9f22c2b31">lodCallback</a> = &amp;callback;</div><div class="line">parameters.lodCallbackLod = 3;</div><div class="line">...</div><div class="line">rootChunk-&gt;load(parent, from, to, 3, &amp;parameters);</div></div><!-- fragment --><p> Or in case of loading from a configuration file: </p><div class="fragment"><div class="line">MyMeshBuilderCallback callback;</div><div class="line">rootChunk-&gt;load(parent, sceneManager, <span class="stringliteral">&quot;myVolume.cfg&quot;</span>, 0, &amp;callback, 3);</div></div><!-- fragment --><p>You might have seen, that a pointer to a SimpleRenderable is handed in, too. This is actually the Chunk whose triangles are loaded. It's parent class is used to not create a circular dependency. You might get the triangle data from it, too by getting the Renderoperation.</p>
<h1><a class="anchor" id="intersecting"></a>
Intersecting a ray with a volume</h1>
<p>When you want to do something exactly on the volume surface, you can cast rays and find their first intersection point. Behold that the triangle representation might be slightly different than the actual volume surface. And you have to scale the ray origin just like the volume. Here is an example which uses the negative z-axis of the camera as ray as it might be done like in an ego-shooter: </p><div class="fragment"><div class="line">Ray ray(mCamera-&gt;getPosition() / rootChunk-&gt;getScale(), -mCamera-&gt;getOrientation().zAxis());</div><div class="line">Vector3 intersection;</div><div class="line"><a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a> scale = mVolumeRoot-&gt;getChunkParameters()-&gt;scale;</div><div class="line"><span class="keywordtype">bool</span> intersects = mVolumeRoot-&gt;getChunkParameters()-&gt;src-&gt;getFirstRayIntersection(ray, intersection, scale);</div><div class="line"><span class="keywordflow">if</span> (intersects)</div><div class="line">{</div><div class="line">    intersection *= scale; <span class="comment">// As it is in volume space.</span></div><div class="line">    <span class="comment">// Do something with intersection.</span></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="editing"></a>
Editing a Volume made from a GridSource</h1>
<p>A usecase is realtime editing of volume terrain as seen as in the sample. Let's union the terrain with a sphere of the radius 2.5 and the center 123/123/123. <b>volumeRoot</b> is the Chunk instance with which the terrain was initially loaded. The factor 1.5 is just to have a save border arround the sphere which also gets updated. The rest of the parameters are 5 LOD levels and a volume mesh covering an area of 384^3. </p><div class="fragment"><div class="line">Vector3 center(123);</div><div class="line"><a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a> radius = (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)2.5;</div><div class="line">CSGSphereSource sphere(radius, center);</div><div class="line">CSGUnionSource operation;</div><div class="line"><span class="keyword">static_cast&lt;</span>GridSource*<span class="keyword">&gt;</span>(volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#acdc6b1e00c67353f3317e1e0ce6d19d9">getChunkParameters</a>()-&gt;<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#a111c9e9333e7ae3497fc818190a03fd8">src</a>)-&gt;combineWithSource(&amp;operation, &amp;sphere, center, radius * (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)1.5);</div><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#acdc6b1e00c67353f3317e1e0ce6d19d9">getChunkParameters</a>()-&gt;<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#aeefacd1d618206fcb432ed947b58e06e">updateFrom</a> = center - radius * (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)1.5;</div><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#acdc6b1e00c67353f3317e1e0ce6d19d9">getChunkParameters</a>()-&gt;<a class="code" href="struct_ogre_1_1_volume_1_1_chunk_parameters.html#afe30999e8cc71a1f48d87d68bf43059d">updateTo</a> = center + radius * (<a class="code" href="namespace_ogre.html#aa3a7b6dfb905e6572d62f0dfa3d4274d">Real</a>)1.5;</div><div class="line">volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#a9557d5a30cbf29a46d4f8246a1e6d176">load</a>(volumeRootNode, Vector3::ZERO, Vector3(384), 5, volumeRoot-&gt;<a class="code" href="class_ogre_1_1_volume_1_1_chunk.html#acdc6b1e00c67353f3317e1e0ce6d19d9">getChunkParameters</a>());</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
