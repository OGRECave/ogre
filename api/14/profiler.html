<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE: Using the Profiler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">OGRE<span id="projectnumber">&#160;14.4</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('profiler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using the Profiler</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#profRead">Reading the Display</a></li>
<li class="level1"><a href="#profFeatures">Features</a><ul><li class="level2"><a href="#autotoc_md302">Disabling the Profiler</a></li>
<li class="level2"><a href="#autotoc_md303">Disabling Individual Profiles</a></li>
<li class="level2"><a href="#autotoc_md304">Analyzing Application State</a></li>
<li class="level2"><a href="#autotoc_md305">Logging Results</a></li>
<li class="level2"><a href="#autotoc_md306">Changing the Frequency of Updating the Display</a></li>
</ul>
</li>
<li class="level1"><a href="#profAccuracy">Performance and Accuracy</a></li>
<li class="level1"><a href="#profRemotery">Remotery Backend</a></li>
<li class="level1"><a href="#profRelmode">Release Version Considerations</a></li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>If you are using the <a class="el" href="namespace_ogre.html">Ogre</a> SDK and you want to use the Profiler, it is advisable to switch to the source code version of <a class="el" href="namespace_ogre.html">Ogre</a>, because the SDK is shipped with <code>OGRE_PROFILING=OFF</code>, so instrumentation is disabled by default.</dd></dl>
<p>First you want to initialize the Profiler like this: </p><div class="fragment"><div class="line"><a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a>().setEnabled(<span class="keyword">true</span>);</div>
<div class="ttc" id="aclass_ogre_1_1_profiler_html_a8147f54c4af90377e9cde1a0d9608a58"><div class="ttname"><a href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a></div><div class="ttdeci">static Profiler &amp; getSingleton(void)</div><div class="ttdoc">Get the singleton instance.</div></div>
</div><!-- fragment --><p> This sets up the media that the profiler uses. The reason this is not in the constructor is because the profiler contains media dependencies that people who aren't using the profiler shouldn't have to worry about. The profiler will need you to specify the main program loop. To do this, you call the following at the very beginning of the frameStarted() function in your FrameListener class: </p><div class="fragment"><div class="line"><a class="code hl_define" href="_ogre_profiler_8h.html#af9d7ab83c5a5d7de7579eebe9d27e53d">OgreProfileBegin</a>(<span class="stringliteral">&quot;Ogre Main Loop&quot;</span>);</div>
<div class="ttc" id="a_ogre_profiler_8h_html_af9d7ab83c5a5d7de7579eebe9d27e53d"><div class="ttname"><a href="_ogre_profiler_8h.html#af9d7ab83c5a5d7de7579eebe9d27e53d">OgreProfileBegin</a></div><div class="ttdeci">#define OgreProfileBegin(a)</div><div class="ttdef"><b>Definition</b> OgreProfiler.h:60</div></div>
</div><!-- fragment --><p> and add this at the very end of the frameEnded() function: </p><div class="fragment"><div class="line"><a class="code hl_define" href="_ogre_profiler_8h.html#a292ec22b5d851ef26fa9d7685c18b1f5">OgreProfileEnd</a>(<span class="stringliteral">&quot;Ogre Main Loop&quot;</span>);</div>
<div class="ttc" id="a_ogre_profiler_8h_html_a292ec22b5d851ef26fa9d7685c18b1f5"><div class="ttname"><a href="_ogre_profiler_8h.html#a292ec22b5d851ef26fa9d7685c18b1f5">OgreProfileEnd</a></div><div class="ttdeci">#define OgreProfileEnd(a)</div><div class="ttdef"><b>Definition</b> OgreProfiler.h:61</div></div>
</div><!-- fragment --><p> Make sure the names match exactly, otherwise the profiler will fail an assert. Next you want to profile some of your code. You do this by calling <a class="el" href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile()</a> and using braces ({}) to limit the scope. Note that OgreProfile cannot be called in the same scope as another <a class="el" href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile()</a>. Doing so will result in a compile-time error. Here is an example of using OgreProfile: </p><div class="fragment"><div class="line">{</div>
<div class="line">   <a class="code hl_define" href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile</a>(<span class="stringliteral">&quot;Collision Detection&quot;</span>);</div>
<div class="line">   mISQR = mISQ-&gt;execute();</div>
<div class="line">}</div>
<div class="line">{</div>
<div class="line">   <a class="code hl_define" href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile</a>(<span class="stringliteral">&quot;Collision Response&quot;</span>);</div>
<div class="line">   SceneQueryMovableIntersectionList::iterator iter;</div>
<div class="line">   <span class="keywordflow">for</span> (iter = mISQR.movables2movables.begin(); iter != mISQR.movables2movables.end(); iter++) {</div>
<div class="line">      <span class="comment">// do stuff</span></div>
<div class="line">      <a class="code hl_define" href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile</a>(<span class="stringliteral">&quot;Explosions&quot;</span>);</div>
<div class="line">      createExplosion();</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="ttc" id="a_ogre_profiler_8h_html_a1654899e6cfdec9f0972a45f3fa3fee7"><div class="ttname"><a href="_ogre_profiler_8h.html#a1654899e6cfdec9f0972a45f3fa3fee7">OgreProfile</a></div><div class="ttdeci">#define OgreProfile(a)</div><div class="ttdef"><b>Definition</b> OgreProfiler.h:59</div></div>
</div><!-- fragment --><p> If you want a profile to last outside of its scope, use <a class="el" href="_ogre_profiler_8h.html#af9d7ab83c5a5d7de7579eebe9d27e53d">OgreProfileBegin(&lt;name&gt;)</a> and <a class="el" href="_ogre_profiler_8h.html#a292ec22b5d851ef26fa9d7685c18b1f5">OgreProfileEnd(&lt;name&gt;)</a> like you did when creating the main loop profile.</p>
<h1><a class="anchor" id="profRead"></a>
Reading the Display</h1>
<div class="image">
<img src="profiler.jpg" alt=""/>
</div>
    <p>On the left side are the profile names with a number in parentheses next to it. This number is the number of times this profile was called during this frame. If this number is 0, that means that the profile was called before, but is not being called currently. The bars on the left represent the frame time statistics. You can see indicators above which show that a profile can take anywhere from 0% to 100% of the frame time. The big yellow bars show the current frame percentage that the profile is taking. The green line shows the minimum frame time, the red line is the maximum frame time, and the blue line is the average frame time. Big discrepancies between the average and maximum can possibly be the sign of a performance bottleneck (however it could be the profiler acting strangely, see the ''Known Issues'' section). These results will be printed to the log when the application ends or you can manually do it by calling logResults().</p>
<h1><a class="anchor" id="profFeatures"></a>
Features</h1>
<h2><a class="anchor" id="autotoc_md302"></a>
Disabling the Profiler</h2>
<p>You can disable the profiler by calling: </p><div class="fragment"><div class="line"><a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a>().setEnabled(<span class="keyword">false</span>);</div>
</div><!-- fragment --><p> and enable it again by calling: </p><div class="fragment"><div class="line"><a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a>().setEnabled(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p> Note that this is a temporary solution. If you want to completely disable the profiler for your release version, see the section ''Release Version Considerations''.</p>
<h2><a class="anchor" id="autotoc_md303"></a>
Disabling Individual Profiles</h2>
<p>Disabling profiles can be useful if there are certain core functions that you want to profile on occasion. For example, you could profile certain rendering operations when you are checking general performance and then disable those profiles when you want to profile your AI code. You can disable a profile like this: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().disableProfile(<span class="stringliteral">&quot;&lt;profile name&gt;&quot;</span>);</div>
<div class="ttc" id="aclass_ogre_1_1_profiler_html"><div class="ttname"><a href="class_ogre_1_1_profiler.html">Ogre::Profiler</a></div><div class="ttdoc">The profiler allows you to measure the performance of your code.</div><div class="ttdef"><b>Definition</b> OgreProfiler.h:236</div></div>
</div><!-- fragment --><p> and you can enable it again with this: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().enableProfile(<span class="stringliteral">&quot;&lt;profile name&gt;&quot;</span>);</div>
</div><!-- fragment --><p> Please note that trying to enable or disable a profile while that profile is running will have no effect.</p>
<h2><a class="anchor" id="autotoc_md304"></a>
Analyzing Application State</h2>
<p>It is helpful to see the state of your application when a profile reaches a maximum level or some other condition. To check if a specific has reached a new maximum level, use: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().watchForMax(<span class="stringliteral">&quot;&lt;profile name&gt;&quot;</span>); <span class="comment">// return true if it reaches a new maximum</span></div>
</div><!-- fragment --><p> or to see if a profile has reached a new minimum level, use: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().watchForMin(<span class="stringliteral">&quot;&lt;profile name&gt;&quot;</span>); <span class="comment">// returns true if it reaches a new minimum</span></div>
</div><!-- fragment --><p> or to set an arbitrary level: </p><div class="fragment"><div class="line"><span class="comment">//returns true when AI code takes over 60% of the frame time</span></div>
<div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().watchForLimit(<span class="stringliteral">&quot;AI code&quot;</span>, .6, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//returns true when graphics code takes less than 10% of the frame time</span></div>
<div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().watchForLimit(<span class="stringliteral">&quot;Graphics code&quot;</span>, .1, <span class="keyword">false</span>);</div>
</div><!-- fragment --><p>These functions should be used at the end of the main game loop for more accuracy. Otherwise, it will represent the results of the previous frame.</p>
<h2><a class="anchor" id="autotoc_md305"></a>
Logging Results</h2>
<p>You can log the results of the current profiler statistics like this: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().logResults();</div>
</div><!-- fragment --><p> This is called automatically when you quit your <a class="el" href="namespace_ogre.html">Ogre</a> application.</p>
<h2><a class="anchor" id="autotoc_md306"></a>
Changing the Frequency of Updating the Display</h2>
<p>You can change how frequently the display is updated to suit your tastes like this: </p><div class="fragment"><div class="line"><a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>.<a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">getSingleton</a>().setUpdateDisplayFrequency(&lt;numberOfFrames&gt;);</div>
</div><!-- fragment --><p> Basically the tradeoff is between how accurate the display is and the amount of flicker. The default is that the display is updated every 10 frames.</p>
<h1><a class="anchor" id="profAccuracy"></a>
Performance and Accuracy</h1>
<p>I've tried to minimize the performance hit from using the profiler. However, like anything else, it still takes some time to perform the necessary calculations. There are some steps you can take to increase the accuracy of the results. Firstly, although the profiler supports multiple calls of a profile during each frame, doing this more than a few times can cause the profiler to take significantly longer than the actual code you are trying to profile. Therefore it is recommended that you move the profile up one level (such as outside of a for loop) so that it is called fewer times.</p>
<p>To maximize the accuracy of a profile, it is best to remove the child profiles of the profile you are analysing. Child profiles increases the frame time of the parent due to the overhead of using the profiler.</p>
<p>Some tests I've conducted show that the profiling code will max out unexpectedly, so take the maximum frame time value with a grain of salt (See the <em>Known Issues</em> section). I think this only happens when a profile is first created, so you can possibly get around this issue by calling the reset() function after the first frame.</p>
<h1><a class="anchor" id="profRemotery"></a>
Remotery Backend</h1>
<p>If you need some more overview or want to profile a remote device, the profiler optionally supports using <a href="https://github.com/Celtoys/Remotery">Remotery</a>.</p>
<p>To enable the Remotery backend set <code>OGRE_PROFILING_REMOTERY_PATH</code> in CMake to point to the <code>Remotery/lib</code> directory (containing <code>Remotery.c</code>). Remotery will be compiled into OgreMain and can be accessed as usual.</p>
<p>Note that no features besides <a class="el" href="class_ogre_1_1_profiler.html#a91c40e21a3fc96003504ea21fec80d77" title="Sets whether this profiler is enabled.">Ogre::Profiler::setEnabled</a> are available when using Remotery.</p>
<h1><a class="anchor" id="profRelmode"></a>
Release Version Considerations</h1>
<p>For the release version of your app, you should set <code>OGRE_PROFILING=OFF</code> in CMake. If the build you are using has been compiled with the <code>OGRE_PROFILING=OFF</code> and you still want to use instrumentation, you can instantiate a dummy profiler like this:</p>
<div class="fragment"><div class="line"><span class="comment">// Create dummy profile to set singleton pointer</span></div>
<div class="line"><span class="keyword">new</span> <a class="code hl_class" href="class_ogre_1_1_profiler.html">Ogre::Profiler</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Give it a timer and enable it</span></div>
<div class="line"><a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a>().setTimer(Root::getSingleton().getTimer());</div>
<div class="line"><a class="code hl_function" href="class_ogre_1_1_profiler.html#a8147f54c4af90377e9cde1a0d9608a58">Ogre::Profiler::getSingleton</a>().setEnabled(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p>The profiler will now work but the 3 OgreProfile macro will not work. You will have to manually use the beginProfile() and endProfile() method. You can also instantiate scope-limited Profile objects or simply define your own macros somewhere in your code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MyScopedProfile( a ) Ogre::Profile _OgreProfileInstance( (a) )</span></div>
<div class="line"><span class="preprocessor">#define MyProfileBegin( a ) Ogre::Profiler::getSingleton().beginProfile( (a) )</span></div>
<div class="line"><span class="preprocessor">#define MyProfileEnd( a ) Ogre::Profiler::getSingleton().endProfile( (a) )</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
