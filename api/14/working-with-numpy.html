<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE: Working with Python</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">OGRE<span id="projectnumber">&#160;14.4</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('working-with-numpy.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Working with Python</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#python-highpy">HighPy: A High-Level API</a></li>
<li class="level1"><a href="#python-numpy">NumPy Interoperability</a></li>
<li class="level1"><a href="#python-background-threads">Running Background Threads</a></li>
</ul>
</div>
<div class="textblock"><p>Ogre features a Python component that automatically generates bindings from the C++ headers. This allows you to use <a class="el" href="namespace_ogre.html">Ogre</a> in your Python code with an API that largely mirrors the C++ API, meaning you can often refer to the existing C++ documentation and tutorials.</p>
<p>Beyond this direct mapping, the bindings also support standard Python protocols. This enables a more "pythonic" workflow, especially when integrating with other libraries like NumPy.</p>
<p>Additionally, Ogre provides a high-level API called HighPy, designed for convenience and rapid development by abstracting away many of the engine's lower-level details.</p>
<h1><a class="anchor" id="python-highpy"></a>
HighPy: A High-Level API</h1>
<p>The HighPy module transforms Ogre into a lightweight Python renderer. As its name suggests, HighPy provides a high-level API that lets you get started quickly, even without extensive prior knowledge of the Ogre internals.</p>
<p>For instance, rendering a mesh is as simple as: </p><div class="fragment"><div class="line"><span class="keyword">import</span> Ogre.HighPy <span class="keyword">as</span> ohi</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Add the path to your mesh files</span></div>
<div class="line">ohi.user_resource_locations.add(<span class="stringliteral">&quot;your/meshes/path&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create a window and display the mesh</span></div>
<div class="line">ohi.window_create(<span class="stringliteral">&quot;ohi_world&quot;</span>, (800, 600))</div>
<div class="line">ohi.mesh_show(<span class="stringliteral">&quot;ohi_world&quot;</span>, <span class="stringliteral">&quot;DamagedHelmet.glb&quot;</span>, position=(0, 0, -3))</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Start the rendering loop</span></div>
<div class="line"><span class="keywordflow">while</span> ohi.window_draw(<span class="stringliteral">&quot;ohi_world&quot;</span>) != 27: <span class="keywordflow">pass</span></div>
</div><!-- fragment --><p>Want to display a background image? It's just one line: </p><div class="fragment"><div class="line">ohi.imshow(<span class="stringliteral">&quot;ohi_world&quot;</span>, <span class="stringliteral">&quot;image.png&quot;</span>)</div>
</div><!-- fragment --><p>Integrating an ImGui-based user interface is also straightforward. Simply define a callback and enable ImGui for your window:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> <a class="code hl_struct" href="struct_ogre_1_1vector.html">Ogre.ImGui</a> <span class="keyword">as</span> ImGui</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>ui_callback():</div>
<div class="line">    ImGui.ShowDemoWindow()</div>
<div class="line"> </div>
<div class="line">ohi.window_use_imgui(<span class="stringliteral">&quot;ohi_world&quot;</span>, ui_callback)</div>
<div class="ttc" id="astruct_ogre_1_1vector_html"><div class="ttname"><a href="struct_ogre_1_1vector.html">Ogre::vector</a></div><div class="ttdef"><b>Definition</b> OgreDeprecated.h:54</div></div>
</div><!-- fragment --><p>For all details, please refer to the <a class="el" href="namespace_python_1_1_high_py.html">Python.HighPy</a> module documentation.</p>
<h1><a class="anchor" id="python-numpy"></a>
NumPy Interoperability</h1>
<p>The Python bindings support the standard python protocols. In this tutorial, we will look how we can advantage of this to achieve numpy Interoperability in a pythonic way.</p>
<dl class="section note"><dt>Note</dt><dd>this tutorial can be <a href="https://colab.research.google.com/github/OGRECave/ogre/blob/master/Samples/Python/numpy_sample.ipynb">run live in Google Colab here</a>.</dd></dl>
<p>We start with a simple 3 channel python array representing a green gradient:</p>
<div class="fragment"><div class="line">    arr = np.zeros((256, 256, 3), dtype=np.uint8)</div>
<div class="line">    arr[:,:,1] = np.mgrid[0:256,0:256][1]</div>
</div><!-- fragment --><div class="image">
<img src="numpy_arr.png" alt=""/>
</div>
    <p>To be able to load it into Ogre we now have to convert it to <code><a class="el" href="class_ogre_1_1_image.html" title="Class representing an image file.">Ogre.Image</a></code>. The underlying C++ API takes a raw <code>uchar*</code>. However, the python bindings accept any object implementing the Buffer Protocol. This means we can pass the numpy array as is.</p>
<div class="fragment"><div class="line">    ogre_img = <a class="code hl_class" href="class_ogre_1_1_image.html">Ogre.Image</a>()</div>
<div class="line">    ogre_img.loadDynamicImage(arr, 256, 256, Ogre.PF_BYTE_RGB)</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="class_ogre_1_1_texture_manager.html#a8faa10c9150687d1bf229ccff16a8960">Ogre.TextureManager.getSingleton</a>().loadImage(<span class="stringliteral">&quot;gradient&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>, ogre_img)</div>
<div class="ttc" id="aclass_ogre_1_1_image_html"><div class="ttname"><a href="class_ogre_1_1_image.html">Ogre::Image</a></div><div class="ttdoc">Class representing an image file.</div><div class="ttdef"><b>Definition</b> OgreImage.h:61</div></div>
<div class="ttc" id="aclass_ogre_1_1_texture_manager_html_a8faa10c9150687d1bf229ccff16a8960"><div class="ttname"><a href="class_ogre_1_1_texture_manager.html#a8faa10c9150687d1bf229ccff16a8960">Ogre::TextureManager::getSingleton</a></div><div class="ttdeci">static TextureManager &amp; getSingleton(void)</div><div class="ttdoc">Get the singleton instance.</div></div>
</div><!-- fragment --><p>Note that <code><a class="el" href="class_ogre_1_1_image.html" title="Class representing an image file.">Ogre.Image</a></code> is merely a view on the underlying array and no data is copied. While this is efficient, it also means that you have to ensure that the array does not get out of scope manually. Otherwise the application will crash due to accessing an invalid pointer.</p>
<p>For completeness we also create a small scene where we map the texture on a screen-centred rectangle. </p><div class="fragment"><div class="line">    mat = <a class="code hl_function" href="class_ogre_1_1_material_manager.html#ae755a83a5d2d1dea391d8c1c74371e4f">Ogre.MaterialManager.getSingleton</a>().create(<span class="stringliteral">&quot;gradient_mat&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>)</div>
<div class="line">    rpass = mat.getTechniques()[0].getPasses()[0]</div>
<div class="line">    rpass.setLightingEnabled(<span class="keyword">False</span>)</div>
<div class="line">    rpass.createTextureUnitState(<span class="stringliteral">&quot;gradient&quot;</span>)</div>
<div class="line"> </div>
<div class="line">    rect = scn_mgr.createScreenSpaceRect(<span class="keyword">True</span>)</div>
<div class="line">    rect.setCorners(-0.5, 0.5, 0.5, -0.5) <span class="comment"># in normalized screen space</span></div>
<div class="line">    rect.setMaterial(mat)</div>
<div class="line"> </div>
<div class="line">    scn_mgr.getRootSceneNode().createChildSceneNode().attachObject(rect)</div>
<div class="ttc" id="aclass_ogre_1_1_material_manager_html_ae755a83a5d2d1dea391d8c1c74371e4f"><div class="ttname"><a href="class_ogre_1_1_material_manager.html#ae755a83a5d2d1dea391d8c1c74371e4f">Ogre::MaterialManager::getSingleton</a></div><div class="ttdeci">static MaterialManager &amp; getSingleton(void)</div><div class="ttdoc">Get the singleton instance.</div></div>
</div><!-- fragment --><p>As the rectangle does not cover the full scene, we also set a background colour </p><div class="fragment"><div class="line">    gray = np.array([0.3, 0.3, 0.3])</div>
<div class="line">    vp.setBackgroundColour(gray)</div>
</div><!-- fragment --><p> Here, the standard python sequence protocol is used. Therefore, the data is copied.</p>
<p>Finally, we want read-back rendered image into an array. To avoid superficial copies of the data, we again allocate the memory with numpy:</p>
<div class="fragment"><div class="line">    mem = np.empty((win.getHeight(), win.getWidth(), 3), dtype=np.uint8)</div>
<div class="line">    pb = <a class="code hl_class" href="class_ogre_1_1_pixel_box.html">Ogre.PixelBox</a>(win.getWidth(), win.getHeight(), 1, Ogre.PF_BYTE_RGB, mem)</div>
<div class="line">    win.copyContentsToMemory(pb, pb)</div>
<div class="ttc" id="aclass_ogre_1_1_pixel_box_html"><div class="ttname"><a href="class_ogre_1_1_pixel_box.html">Ogre::PixelBox</a></div><div class="ttdoc">A primitive describing a volume (3D), image (2D) or line (1D) of pixels in memory.</div><div class="ttdef"><b>Definition</b> OgrePixelFormat.h:349</div></div>
</div><!-- fragment --><p>Note, that the convention of specifying width and height is swapped between Ogre and numpy.</p>
<p>Now we can store the image to disk using pyplot.</p>
<div class="fragment"><div class="line">    pyplot.imsave(<span class="stringliteral">&quot;screenshot.png&quot;</span>, mem)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>There is also <a class="el" href="class_ogre_1_1_render_target.html#afb7ac36166a3e7c38a102edc6e7d2c1d" title="Writes the current contents of the render target to the named file.">Ogre::RenderTarget::writeContentsToFile</a> if you do not need the pixel data in <a class="el" href="namespace_python.html">Python</a>.</dd></dl>
<div class="image">
<img src="numpy_final.png" alt=""/>
</div>
    <h1><a class="anchor" id="python-background-threads"></a>
Running Background Threads</h1>
<p>By default, the <a class="el" href="namespace_python.html">Python</a> bindings do not release the GIL (Global Interpreter Lock) during rendering. This design choice prioritizes performance by avoiding the overhead of constantly re-acquiring the GIL. However, it means that other <a class="el" href="namespace_python.html">Python</a> threads will be blocked and unable to run concurrently with the rendering loop.</p>
<p>For example, the following code will not work as you might expect:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> threading</div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>printer():</div>
<div class="line">    <span class="keywordflow">for</span> _ <span class="keywordflow">in</span> range(15):</div>
<div class="line">        print(<span class="stringliteral">&quot;Thread&quot;</span>)</div>
<div class="line"> </div>
<div class="line">threading.Thread(target=printer).start()</div>
<div class="line">root.startRendering()</div>
</div><!-- fragment --><p>The "printer" Thread will be blocked until the rendering is finished.</p>
<p>To enable background threads to run, you can call <code>root.allowPyThread()</code>. This will instruct <a class="el" href="namespace_ogre.html">Ogre</a> to release the GIL while waiting for vsync, allowing other <a class="el" href="namespace_python.html">Python</a> threads to run during this idle time. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
